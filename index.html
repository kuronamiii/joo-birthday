<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Joo's Birthday</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family:"Poppins",system-ui,-apple-system,"Segoe UI",Roboto;
    background:linear-gradient(135deg,#FFDEE9 0%, #B5FFFC 100%);
    -webkit-font-smoothing:antialiased;overflow:hidden;
  }
  .slider-viewport{width:100vw;height:100vh;position:relative;overflow:hidden;touch-action:pan-y;}
  .slides{height:100%;display:flex;transition:transform .45s cubic-bezier(.18,.9,.25,1);}
  .slide{min-width:100%;display:flex;justify-content:center;align-items:center;padding:28px;}
  .card{width:90%;max-width:450px;background:rgba(255,255,255,0.12);backdrop-filter:blur(10px);
    border-radius:20px;padding:34px;text-align:center;color:#fff;box-shadow:0 10px 30px rgba(0,0,0,0.16);}
  .title{font-size:clamp(18px,3vw,28px);margin-bottom:12px}
  .subtitle{font-size:clamp(13px,2vw,16px);opacity:0.95;margin-bottom:14px}
  .btn{margin-top:14px;padding:12px 22px;border-radius:12px;border:none;background:#fff;color:#ff416c;font-weight:700;cursor:pointer;box-shadow:0 8px 20px rgba(0,0,0,0.12)}
  .frame{width:240px;height:240px;border-radius:16px;border:6px solid rgba(255,255,255,0.9);background:url('https://i.imgur.com/lOqQ0Yy.jpg')center/cover;margin:14px auto;box-shadow:0 14px 36px rgba(0,0,0,0.18)}
  .jackpot{display:flex;gap:14px;justify-content:center;margin-top:18px}
  .reel{width:78px;height:96px;border-radius:12px;background:linear-gradient(#fff,#f6f6f6);box-shadow:inset 0 -8px 20px rgba(0,0,0,0.06),0 8px 20px rgba(0,0,0,0.12);overflow:hidden;position:relative;display:flex;align-items:center;justify-content:center}
  .reel .emoji{position:absolute;font-size:36px}
  .rolling .emoji{animation:rollDown 620ms cubic-bezier(.2,.9,.3,1)}
  @keyframes rollDown{
    0%{transform:translateY(-120%);filter:blur(2px);opacity:.6}
    50%{transform:translateY(10%);filter:blur(3px);opacity:1}
    100%{transform:translateY(0);filter:blur(0);opacity:1}
  }
  .confetti{position:absolute;inset:0;pointer-events:none;overflow:hidden;z-index:40}
  .confetti .piece{position:absolute;width:10px;height:12px;border-radius:2px;animation:confFall var(--dur,3s) linear forwards}
  @keyframes confFall{0%{transform:translateY(-10vh) rotate(0)}100%{transform:translateY(110vh) rotate(720deg)}}
  @media(max-width:480px){.card{padding:20px}.frame{width:200px;height:200px}.reel{width:66px;height:84px}.reel .emoji{font-size:30px}}
</style>
</head>
<body>
  <div class="slider-viewport" id="viewport">
    <div class="slides" id="slides">
      <!-- Slide 0 -->
      <section class="slide" style="background:url('bg/bg-kuromi.jpg')center/cover;background-repeat: no-repeat;background-attachment: fixed;background-size: cover;">
        <div class="card">
          <div class="title">üéâ Happy 24th Birthday, Joo!</div>
          <div class="subtitle">Wishing you a joyful day!</div>
          <div class="frame" aria-hidden="true" style="background:url('bg/Joo.png')center/cover;background-repeat: no-repeat;background-attachment:fixed;background-size: 100% 100%;"></div>
          <button class="btn" id="next0" onclick="goTo(1)">Next</button>
        </div>
      </section>

      <!-- Slide 1 -->
      <section class="slide" style="background:url('bg/bg-kuromi3.jpg')center/cover;background-repeat: no-repeat;background-attachment: fixed;background-size: cover;">
        <div class="card">
          <div class="title">A heartfelt wish</div>
          <div class="subtitle">May you grow older and become an even better person than before, stronger and prettier for your younger siblings. Stay true to yourself, and always live your life with passion. xoxo. üç∞</div>
          <button class="btn" id="next1" onclick="goTo(2)">Next</button>
        </div>
      </section>

      <!-- Slide 2 -->
      <section class="slide" style="background:url('bg/bg-kuromi2.jpg')center/cover;background-repeat: no-repeat;background-attachment: fixed;background-size: cover;">
        <div class="card">
          <div class="title">Get ready for the gift! üéÅ</div>
          <div class="subtitle">It's not that expensive, but hopefully it will make today a good day for you.</div>
          <button class="btn" id="openGift" onclick="goTo(3)">Open Gift</button>
        </div>
      </section>

      <!-- Slide 3: Jackpot -->
      <section class="slide" style="background:url('bg/bg-kuromi5.jpg')center/cover;background-repeat: no-repeat;background-attachment: fixed;background-size: cover;">
        <div class="card">
          <div class="title">Spin it! Gambler!üòÇ üé∞</div>
          <div class="subtitle">Good luck, Joo!</div>

          <div class="jackpot" id="jackpot">
            <div class="reel" data-index="0"><div class="emoji">üéâ</div></div>
            <div class="reel" data-index="1"><div class="emoji">üéÅ</div></div>
            <div class="reel" data-index="2"><div class="emoji">üéÇ</div></div>
          </div>

          <button class="btn" id="spinBtn" onclick="spin()">Spin</button>
          <div style="margin-top:10px;color:rgba(255,255,255,0.95)">Spins: <span id="spinCount"></span></div>
        </div>
      </section>

      <!-- Slide 4: Congrats -->
      <section class="slide" style="background:url('bg/bg-kuromi6.jpg')center/cover;background-repeat: no-repeat;background-attachment: fixed;background-size: cover;">
        <div class="card">
          <div class="title">üéä Congratulations! üéà</div>
          <div class="subtitle">You unlocked your birthday surprise!</div>
          <button class="btn" id="replay" onclick="goTo(0)">Replay</button>
        </div>
      </section>
    </div>

    <div class="confetti" id="confetti"></div>
  </div>

<script>
/* --- Slider / touch handlers --- */
const slidesEl = document.getElementById('slides');
const viewport = document.getElementById('viewport');
let currentIndex = 0;
let startX = 0, currentX = 0, isDragging = false;

function goTo(index){
  const total = slidesEl.children.length;
  if(index < 0) index = 0;
  if(index >= total) index = total - 1;
  currentIndex = index;
  slidesEl.style.transform = `translateX(-${index * 100}%)`;
}
window.goTo = goTo; // keep inline onclick working

// Helper to detect interactive origins (buttons, spin etc.)
function isInteractiveTarget(el){
  return el && (el.closest && (el.closest('button') || el.closest('.reel') || el.closest('.btn') || el.tagName === 'BUTTON'));
}

// Touchstart: IGNORE touches that start on buttons / reels
viewport.addEventListener('touchstart', e => {
  // ignore multi-touch
  if(e.touches.length > 1) return;
  const target = e.target;
  if (isInteractiveTarget(target)) {
    // do not start swipe when touching buttons or reels
    startX = 0; currentX = 0; isDragging = false;
    return;
  }
  startX = e.touches[0].clientX;
  currentX = startX;
  isDragging = true;
  slidesEl.style.transition = 'none';
}, {passive: true});

// Touchmove: only when dragging started
viewport.addEventListener('touchmove', e => {
  if (!isDragging) return;
  currentX = e.touches[0].clientX;
  const dx = currentX - startX;
  const translate = -currentIndex * viewport.clientWidth + dx;
  slidesEl.style.transform = `translateX(${translate}px)`;
}, {passive: true});

// Touchend: compute dx only if dragging; otherwise ignore
viewport.addEventListener('touchend', e => {
  if (!isDragging) return;
  isDragging = false;
  slidesEl.style.transition = 'transform 420ms cubic-bezier(.18,.9,.25,1)';
  // guard currentX; if undefined or equal to startX -> treat as tap (no slide)
  if (typeof currentX !== 'number') currentX = startX;
  const dx = currentX - startX;
  const threshold = Math.min(80, viewport.clientWidth * 0.18);
  if (dx > threshold) {
    goTo(currentIndex - 1);
  } else if (dx < -threshold) {
    goTo(currentIndex + 1);
  } else {
    goTo(currentIndex); // snap back
  }
  startX = currentX = 0;
}, {passive: true});

// Extra safety: prevent touch events on buttons from reaching viewport handlers
const interactiveButtons = document.querySelectorAll('button, .reel');
interactiveButtons.forEach(btn => {
  btn.addEventListener('touchstart', e => e.stopPropagation(), {passive: true});
  btn.addEventListener('touchend', e => e.stopPropagation(), {passive: true});
});

/* --- Jackpot logic & rolling animation --- */
const emojis = ['üéâ','üéÅ','üéÇ','üçÄ','üíñ','‚≠ê','üç∞','üç≠','üåü'];
const reels = document.querySelectorAll('.reel');
const spinBtn = document.getElementById('spinBtn');
const spinCountEl = document.getElementById('spinCount');
let spinCount = 0;
let busy = false;

function spin(){
  if (busy) return;
  busy = true;
  // small debounce to avoid double presses
  spinBtn.disabled = true;
  setTimeout(()=>{ spinBtn.disabled = false; }, 700);

  spinCount++;
  spinCountEl.textContent = spinCount;

  const isJackpot = spinCount >= 5;
  // pick winning emoji if jackpot
  const winningEmoji = isJackpot ? emojis[Math.floor(Math.random()*emojis.length)] : null;

  // animate each reel downward with stagger
  reels.forEach((r, i) => {
    const emojiEl = r.querySelector('.emoji');
    r.classList.add('rolling');
    // choose emoji for this spin (if jackpot: same emoji; else: random)
    const chosen = isJackpot ? winningEmoji : emojis[Math.floor(Math.random()*emojis.length)];
    // stagger by i*120ms to simulate sequential reels
    const delay = 120 * i;
    setTimeout(() => {
      emojiEl.textContent = chosen;
      // remove class slightly after animation finishes
      setTimeout(() => { r.classList.remove('rolling'); }, 650);
      if (i === reels.length - 1) {
        // final reel finished; allow next spin
        busy = false;
        // if jackpot, move to congrats slide and confetti
        if (isJackpot) {
          setTimeout(() => {
            goTo(4);
            burstConfetti();
            spinCount = 0;
            spinCountEl.textContent = spinCount;
          }, 700);
        }
      }
    }, delay);
  });
}
window.spin = spin;

/* --- Confetti --- */
function burstConfetti(){
  const conf = document.getElementById('confetti');
  conf.innerHTML = '';
  const pieces = 72;
  for (let i = 0; i < pieces; i++){
    const p = document.createElement('div');
    p.className = 'piece';
    p.style.left = Math.random() * 100 + 'vw';
    p.style.top = (-10 - Math.random()*20) + 'vh';
    p.style.background = `hsl(${Math.random()*360} 90% 60%)`;
    p.style.setProperty('--dur', (2 + Math.random()*3) + 's');
    conf.appendChild(p);
    // cleanup
    setTimeout(()=> p.remove(), 7000);
  }
}

/* init: ensure slide positioning on resize */
window.addEventListener('resize', ()=> goTo(currentIndex));
</script>
</body>
</html>
